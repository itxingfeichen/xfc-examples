# Spring-事务
##  相关概念
*   事务：是访问并可能更新数据库中各种数据项的一个程序执行单元
*   特点
    *   原子性：一个事务是一个不可分割的工作单位，要么都成功，要么都失败
    *   一致性：事务必须是数据库从一个一致性状态到另一个一致性状态，一致性和原子行密切相关
    *   隔离型：一个执行的执行不能被其他事务影响，也就是事务之间的操作和是隔离的
    *   持久性：也称永久性，事务提交成功后，数据将会被永久性修改
*   sql执行过程
    *   insert执行过程
        +   先把要插入的数据存入临时表
        +   将临时表中数据插入到数据库
        +   如果没有问题，就复制一份数据到真是表中并返回影响条数，如果有问题，返回错误给用户（也会记录日志）
        +   删除临时表
    *   delete（删除全部，表锁，带条件为行级锁）
        +   先根据条件从实际表中查询出要更新的数据，然后将数据锁定（行级锁）
        +   将这些数据放于临时表
        +   执行删除，如果成功，则返回影响条数。如果错误，返回错误信息给用户，原来的数据原封不动
        +   删除临时表中的数据
    *   update（修改全部，表锁，带条件为行级锁）
        +   先根据条件从实际表中查询出要更新的数据，然后将数据锁定（行级锁）
        +   将这些数据放于临时表
        +   执行修改，如果成功，则返回影响条数。如果错误，返回错误信息给用户，原来的数据原封不动
        +   删除临时表中的数据
*   事务的执行过程
    +   开启事务（open）
    +   执行事务（execution）
    +   提交事务（手动或自动）/事务回滚（rollback）
    +   关闭事务（close）
*   数据库隔离级别
--------------
|隔离级别|隔离级别的值|导致的问题|
|:---:|:---:|:---:|
|Read-Uncommited|0|读到未提交的数据(脏读)|
|Read-Commited|1|读已提交（避免脏读，允许不可重读和幻读（默认的））|
|Reapeat-Read|2|可重复读（避免脏读，不可重复读，允许幻读）|
|Serialiable|3|串行化读，事务只能一个一个执行，免脏读，不可重复读，幻读，但是效率低，执行慢|
-----------
![数据库的隔离级别](./images/mysql的事务隔离级别.png '隔离级别')    
    
##  spring中的事务（基于aop实现）
*   事务传播机制(// todo)
    *   DEFAULT
    *   REQUIRED
    *   EQUIRES_NEW
    *   SUPPORTS
    *   NESTED
*   事务配置        




     